<link rel="import" href="/bower_components/polymer/polymer.html">

<dom-module id="crud-classes-list">

    <!-- scoped CSS for this element -->
    <style>
        :host {
            /*display: block;*/
        }

        #list_container {
            padding: 20px;
            border-bottom: 1px solid #ddd;
        }

        #contexts_container {
            border-bottom: 1px solid #ddd;
        }

        #children_container {
        }

    </style>

    <template>
        <div>
            <div id="list_container">
                <content></content>
                </div>
        </div>
        <div id="contexts_container"></div>
        <div id="children_container"></div>
    </template>

    <script>
        var crudClassesList = {
            component: Polymer({
                is: "crud-classes-list",

                ready: function () {
                    for (var class_name in crud.config) {
                        var row_component = new CrudClassesListRow.component(class_name, this);

                        Polymer.dom(this).appendChild(row_component);
                    }
                },

                updateFromHash: function() {
                    var hash = window.location.hash;

                    // remove leading hash
                    if (hash.substring(0, 1) == '#'){
                        hash = hash.substring(1);
                    }

                    var hash_obj = JSON.parse(hash);

                    //this.$.contexts_container.innerHTML = '';
                    //this.children_container.innerHTML = '';

                    var table_polymer = new CrudTable.component(hash_obj.class_name);
                    if (hash_obj.editor) {
                        var obj_full_id = hash_obj.editor.obj_full_id;
                        var editor_component = new crudEditor.component(obj_full_id, table_polymer);
                        table_polymer.crud_setActiveEditor(editor_component);
                    }

                    this.crud_replaceChildren(table_polymer);

                },

                crud_updateContext: function(crud_table_polymer, append) {
                    var contexts_container = this.$.contexts_container;

                    var hash = crud_table_polymer.crud_getContextHash();
                    var str = crud_table_polymer.crud_getContextStr();
                    var hash_str = JSON.stringify(hash);

                    var elem = document.createElement('div');
                    elem.textContent = str;

                    var classes_list_polymer = this;

                    elem.onclick = function(){
                        //alert(hash_str);
                        window.location.hash = hash_str;
                        classes_list_polymer.updateFromHash();
                    };

                    if (!append) {
                        var lc = Polymer.dom(contexts_container).lastChild;
                        if (lc) {
                            Polymer.dom(contexts_container).removeChild(lc);
                        }
                    }
                    Polymer.dom(contexts_container).appendChild(elem);

                    window.location.hash = hash_str;
                },

                /*
                crud_addContext: function(context) {
                    var contexts_container = this.$.contexts_container;
                    //Polymer.dom(contexts_container).innerHTML = '';
                    var elem = document.createElement('div');
                    elem.textContent = context;
                    Polymer.dom(contexts_container).appendChild(elem);
                },
                */

                crud_replaceChildren: function(list) {
                    var children_container = this.$.children_container;
                    Polymer.dom(children_container).innerHTML = '';
                    Polymer.dom(children_container).appendChild(list)
                }
            })
        };
    </script>

</dom-module>