<!doctype html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        html {
            overflow-y:scroll;
        }

        body {
            background-color: #f9f9f9;
        }

        #page-content{
            /*padding: 30px;*/
            height: 100%;
        }

        /*
        a {
            text-decoration: none;
        }
        */
    </style>

</head>
<body>

<link rel="stylesheet" href="https://storage.googleapis.com/code.getmdl.io/1.0.0/material.indigo-pink.min.css">
<script src="https://storage.googleapis.com/code.getmdl.io/1.0.0/material.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

<script>
    // Document-level global Polymer settings can be set by creating a Polymer object on window before importing the Polymer library
    window.Polymer = window.Polymer || {};
    window.Polymer.dom = 'shadow'; // oLog: "shady" implementation (default) is waaay faster (2x)
</script>

<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
<script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>

<script src="public/crud.js"></script>
<script src="public/socket.js"></script>
<script src="public/storage.js"></script>
<script src="public/model.js"></script>

<!-- TODO: auto-include components? -->
<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="bower_components/paper-input/paper-textarea.html">
<link rel="import" href="bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="bower_components/paper-styles/paper-styles.html">
<link rel="import" href="bower_components/iron-pages/iron-pages.html">
<link rel="import" href="bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="bower_components/paper-material/paper-material.html">
<link rel="import" href="bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="bower_components/paper-item/paper-item.html">
<link rel="import" href="bower_components/paper-item/paper-item-body.html">
<link rel="import" href="bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="public/crud_table_row.html">
<link rel="import" href="public/crud_table.html">
<link rel="import" href="public/crud_table_filter.html">
<link rel="import" href="public/crud_table_order.html">
<link rel="import" href="public/crud_classes_list.html">
<link rel="import" href="public/crud_classes_list_row.html">
<link rel="import" href="public/crud_editor.html">
<link rel="import" href="public/crud_table_cell_text.html">
<link rel="import" href="public/crud_table_cell_timestamp.html">
<link rel="import" href="public/crud_editor_field_input.html">
<link rel="import" href="public/crud_editor_field_modelid.html">
<link rel="import" href="public/crud_editor_field_textarea.html">
<link rel="import" href="public/crud_editor_save_buttons.html">

<!--<div id="page-content"></div>-->

<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
    <header class="mdl-layout__header">
        <div class="mdl-layout__header-row">
            <span class="mdl-layout-title">CRUD 2015</span>
        </div>
    </header>
    <div class="mdl-layout__drawer">
        <span class="mdl-layout-title">Drawer</span>
        <nav class="mdl-navigation">
        </nav>
    </div>
    <main class="mdl-layout__content">
        <div id="page-content">
        </div>
    </main>
</div>


<script>

    var classes_list_component = new crudClassesList.component();
    document.querySelector('#page-content').appendChild(classes_list_component);

    initClassesList(classes_list_component);

    var hash = window.location.hash;
    if (hash){
        //classes_list_component.crud_updateFromHash(); // сейчас не заработает, потому что перед показом редактора для объекта модель должна быть загружена в хранилище. т.е. активировать редактор можно только после ответа от апи на запрос таблицы с фильтрами
    }

    function initClassesList(classes_list_component){
        for (var class_name in crud.config) {
            //var row_component = new CrudClassesListRow.component(class_name, classes_list_component);
            //<a class="mdl-navigation__link" id="edit_link" href="#"></a>
            var a = document.createElement('a');
            a.classList.add('mdl-navigation__link');
            var class_title = crud.getClassTitleByName(class_name);
            a.textContent = class_title;
            a.dataset.crud_class_name = class_name;

            a.onclick = function(){
                var class_name = this.dataset.crud_class_name;
                var table_polymer = new CrudTable.component(class_name);

                classes_list_component.crud_replaceChildren(table_polymer);

                classes_list_component.crud_clearContexts();
                classes_list_component.crud_updateContext(table_polymer, true);

                return true;
            };

            document.querySelector('.mdl-navigation').appendChild(a);
        }

    }

</script>

</body>
</html>